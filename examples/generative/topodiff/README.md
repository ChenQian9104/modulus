<!-- markdownlint-disable -->

# TopoDiff
We propose Topodiff, a conditional diffusion-model-based architecture to perform performance-aware and manufacturability-aware topology optimization that overcomes the issues of Generative Adversarial Networks (GANs) such as difficult to train, limited generalizability and neglecting manufacturability. Topodiff introduces a surrogate model-based guidance strategy that actively favors structures with low compliance and good manufacturability.
- Link to the paper: [Link](https://arxiv.org/abs/2208.09591)
- Link to the project: [Link](https://decode.mit.edu/projects/topodiff/)

<p align="center">
<img src="../../../docs/img/topodiff_doc/topodiff.png" width="840" />
</p>

## Dataset
- Link to the complete dataset: [here](https://www.dropbox.com/home/decode_lab/Datasets/Public%20Documents/Topodiff_dataset)
- Link to the dataset for diffusion model training: [here](https://www.dropbox.com/scl/fi/9jy96a0lyf39wdwc27se7/dataset_1_diff.zip?rlkey=zz0ijw8e5h0hf0fb7qpnbwrgu&st=t7nuh1w7&dl=0)
- Link to the dataset for regression model training: [here](https://www.dropbox.com/scl/fi/486kmqbghzxuxqewjm9b4/dataset_2_reg.zip?rlkey=gw8yu1lv40tqk192py7wsl9o9&st=ao9yc1rw&dl=0)
- Link to the dataset for classifier model training: [here](https://www.dropbox.com/scl/fi/486kmqbghzxuxqewjm9b4/dataset_2_reg.zip?rlkey=gw8yu1lv40tqk192py7wsl9o9&st=ao9yc1rw&dl=0)


Download the dataset and set the **path_data** in [the config yaml file](conf/config.yaml)

## Instructions 
2D topology structures could be generated by Topodiff conditioned on the boundary and loading conditions. A few examples are shown below: 
<p align="center">
<img src="../../../docs/img/topodiff_doc/topology_generated.png" width="840" />
</p>

### Model training 
Before training the model, config.yaml should be: 
```
hydra:
  job:
    chdir: True
  run:
    dir: ./outputs/


path_data: path to the Topodiff dataset downloaded 

epochs: 100000
batch_size: 128
lr: 1e-4 

classifier_iterations: 20000
regressor_iterations: 20000
diffusion_steps: 1000

generation_path: ./

model_path_diffusion: path to the pt file of the diffusion model
model_path_classifier: path to the pt file of the classifier for floating material


path_training_data_diffusion: path to the /dataset_1_diff/training_data/

path_data_regressor_training: path to the /dataset_2_reg/training_data/
path_data_regressor_validation:  path to the /dataset_2_reg/validation_data/

path_data_classifier_training: path to the /dataset_3_class/training_data/
path_data_classifier_validation:  path to the /dataset_3_class/validation_data/

```

Run the following command to train the diffusion model, classifier for floating material and regressor for compliance:
```Bash
python examples/generative/topodiff/train.py
python examples/generative/topodiff/train_classifier.py
python examples/generative/topodiff/train_regressor.py
```
### Generation
By default, the generated topologies are conditioned on the boundary and loading conditions that have not been seen in the training process.
Run the following command to generate topologies: 
```Bash
python examples/generative/topodiff/inference.py
```




## Citations
To cite this work, please use the following reference:

```bibtex
@inproceedings{maze2023diffusion,
  title={Diffusion models beat gans on topology optimization},
  author={Maz{\'e}, Fran{\c{c}}ois and Ahmed, Faez},
  booktitle={Proceedings of the AAAI conference on artificial intelligence},
  volume={37},
  number={8},
  pages={9108--9116},
  year={2023}
}
```

## References
- [Diffusion Models Beat GANs on Topology Optimization](https://decode.mit.edu/assets/papers/2022_maze_topodiff.pdf)
- [Topodiff Project Page](https://decode.mit.edu/projects/topodiff/)
- [Topodiff Dataset](https://www.dropbox.com/home/decode_lab/Datasets/Public%20Documents/Topodiff_dataset)
- [Github](https://github.com/francoismaze/topodiff)

